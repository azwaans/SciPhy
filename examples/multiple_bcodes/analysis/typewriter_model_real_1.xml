<?xml version="1.0" encoding="UTF-8" standalone="no"?><beast beautitemplate='MultiTypeBirthDeath' beautistatus='' namespace="lineageTree.substitutionmodel.ScarringLoss:beast.core:beast.evolution.alignment:beast.evolution.tree.coalescent:beast.core.util:beast.evolution.nuc:beast.evolution.operators:beast.evolution.sitemodel:beast.evolution.substitutionmodel:beast.evolution.likelihood:feast" required="" version="2.6">

<data  id="alignment" spec="feast.fileio.AlignmentFromNexus" name="alignment"
           fileName="/Users/azwaans/all_beasts/beast_typewriter/examples/multiple_bcodes/simulated_data/small.clock1.0.seed127.alignment.nexus" >
    <userDataType spec="beast.evolution.datatype.IntegerData"/>
    </data>

    <map name="Uniform" >beast.math.distributions.Uniform</map>
    <map name="Exponential" >beast.math.distributions.Exponential</map>
    <map name="LogNormal" >beast.math.distributions.LogNormalDistributionModel</map>
    <map name="Normal" >beast.math.distributions.Normal</map>
    <map name="Beta" >beast.math.distributions.Beta</map>
    <map name="Gamma" >beast.math.distributions.Gamma</map>
    <map name="LaplaceDistribution" >beast.math.distributions.LaplaceDistribution</map>
    <map name="prior" >beast.math.distributions.Prior</map>
    <map name="InverseGamma" >beast.math.distributions.InverseGamma</map>
    <map name="OneOnX" >beast.math.distributions.OneOnX</map>

    <!-- set all tip dates, time points of sampling to 25 time units -->
    <traitSet id="dateTrait.t:alignment"
              spec="beast.evolution.tree.TraitSet"
              taxa="@TaxonSet.0" traitname="date-forward" value="0=25"
    />
    <!-- set of all cells -->
    <taxa id="TaxonSet.0" spec="TaxonSet">
        <alignment idref="alignment"/>
    </taxa>

    <!-- run MCMC with 10^9 steps -->
    <run id="mcmc" spec="MCMC" chainLength="1000000000">
        <state id="state" spec="State" storeEvery="5000">


            <stateNode id="typewriterTree"  spec="lineageTree.tree.startingTree" rootHeight="20"
                       taxa="@alignment" scarringHeight="20"
                       scarringDuration="5" sequencesAreClustered="false">
                <trait idref="dateTrait.t:alignment"/>
                <taxonset idref="TaxonSet.0"/>
            </stateNode>

            <!-- editing model parameters -->
            <parameter id="insertRates" spec="parameter.RealParameter"
                       lower="0.0" name="stateNode"
                       upper="1000">

                0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.82

            </parameter>

            <parameter id="clockRate" spec="parameter.RealParameter"
                       dimension="1" lower="0.0" name="stateNode"
                       upper="1000"> 0.1 </parameter>

            <!-- population process parameters -->
            <parameter id="birthRate" spec="parameter.RealParameter" dimension="1" lower="0.0" name="stateNode" upper="Infinity">0.5</parameter>

            <parameter id="deathRate" spec="parameter.RealParameter"
                       dimension="1" lower="0.0" name="stateNode"
                       upper="Infinity">0.4</parameter>

            <!-- The sampling rate through time is set to 0 as we only
                 sample at the end of the experiment with sampling
                 proportion rho -->
            <parameter id="samplingRate" spec="parameter.RealParameter"
                       dimension="1" lower="0.0" name="stateNode"
                       upper="1.0">0.0</parameter>

            <!--fix origin to experiment duration, e.g. 25 -->
            <parameter id="origin"
                       spec="parameter.RealParameter" name="stateNode">25
            </parameter>

            <!-- fix sampling proportion to truth -->
            <parameter id="samplingProportion"
                       spec="parameter.RealParameter" lower="0.0"
                       name="stateNode" upper="1.0">0.003 </parameter>

            <parameter id="freqParameter.s:alignment"
                       spec="parameter.RealParameter" dimension="4"
                       lower="0.0" name="stateNode"
                       upper="1.0">0.25</parameter>
        </state>


        <!-- define posterior -->
        <distribution id="posterior" spec="util.CompoundDistribution">

            <!-- tree prior or phylodynamic model. Here, we use a birth-death sampling
            model -->
            <distribution id="prior" spec="util.CompoundDistribution">
                <distribution id="birthDeathMigration.t:alignment" spec="beast.evolution.speciation.BirthDeathSkylineModel"
                              birthRate="@birthRate" deathRate="@deathRate" samplingRate="@samplingRate"
                              contemp="true" origin="@origin" rho="@samplingProportion"
                              tree="@typewriterTree" conditionOnSurvival="true">
                </distribution>


                <prior
                        id="insertRatesPrior" name="distribution"
                        x="@insertRates">
                    <Dirichlet name="distr" spec="beast.math.distributions.Dirichlet">
                        <parameter  spec="parameter.RealParameter"
                                    estimate="false"
                                    name="alpha">
                            1.5 1.5 1.5 1.5 1.5
                            1.5 1.5 1.5 1.5 1.5
                            1.5 1.5 1.5 1.5 1.5
                            1.5 1.5 1.5 1.5
                        </parameter>
                    </Dirichlet>
                </prior>


                <!-- 95% HPD [0.06, 0.13, 0.3] -->
                <prior id="ClockPrior.c:alignment" name="distribution" x="@clockRate">
                    <LogNormal name="distr" M="-2" S="0.5"/>
                </prior>

                <!-- prior distributions on phylodynamic parameters -->
                <!-- 95% HPD [0.1, 0.5, 2.8] -->
                <prior id="birthRatePrior" name="distribution" x="@birthRate">
                    <LogNormal name="distr">
                        <parameter spec="parameter.RealParameter"
                                   estimate="false" name="M">-0.6</parameter>
                        <parameter spec="parameter.RealParameter"
                                   estimate="false"  name="S">1</parameter>
                    </LogNormal>
                </prior>

                <!-- 95% HPD [0.03, 0.14, 0.7] -->
                <prior id="deathRatePrior" name="distribution" x="@deathRate">
                    <LogNormal  name="distr">
                        <parameter spec="parameter.RealParameter"
                                   estimate="false" name="M">-2</parameter>
                        <parameter spec="parameter.RealParameter"
                                   estimate="false"  name="S">1</parameter>
                    </LogNormal>
                </prior>
            </distribution>

            <!-- Typewriter tree likelihood -->
            <!-- Alignment 1 -->
            <distribution id="treeLikelihood.1" spec="lineageTree.distributions.TypewriterTreeLikelihood" data="@alignment" tree="@typewriterTree" origin="@origin" useScaling="true">
                <siteModel id="SiteModel.s:typewriterTest" spec="SiteModel" >
                    <parameter id="mutationRate.s:typewriterTest" spec="parameter.RealParameter" estimate="false" name="mutationRate">1.0</parameter>
                    <parameter id="proportionInvariant.s:typewriterTest" spec="parameter.RealParameter" estimate="false" lower="0.0" name="proportionInvariant" upper="1.0">0.0</parameter>
                    <substModel id="submodel.s:typewriterTest" spec="lineageTree.substitutionmodel.TypewriterSubstitutionModelHomogeneous" editfrequencies="@insertRates">
                        <frequencies id="freq" spec="beast.evolution.substitutionmodel.Frequencies" frequencies="1.0 0" estimate="false"/>
                    </substModel>
                </siteModel>
                <branchRateModel id="StrictClock.c:typewriterTest" spec="beast.evolution.branchratemodel.StrictClockModel" clock.rate="@clockRate"/>
        </distribution>
        </distribution>


        <!-- phylogenetic operators -->
        <operator id="insertProbabilitiesOperator"
                  spec="DeltaExchangeOperator"
                  parameter="@insertRates"
                  weight="30.0"/>

        <operator id="clockRateScaler" spec="ScaleOperator"
                  parameter="@clockRate" scaleFactor="0.8" weight="3.0"/>

        <!-- tree operators -->
        <operator spec="ScaleOperator" tree="@typewriterTree" weight="10.0"/>
        <operator spec="WilsonBalding" tree="@typewriterTree" weight="10.0"/>
        <operator spec="Uniform" tree="@typewriterTree"
                  weight="10.0"/>

        <operator spec="Exchange"
                  isNarrow="true" tree="@typewriterTree"
                  weight="10.0"/>
        <operator spec="SubtreeSlide" tree="@typewriterTree" weight="10.0"/>


        <!-- Phylodynamic operators -->
        <operator id="birthRateScaler" spec="ScaleOperator" parameter="@birthRate" scaleFactor="0.8" weight="3.0"/>

        <operator id="deathRateScaler" spec="ScaleOperator" parameter="@deathRate" scaleFactor="0.8" weight="3.0"/>

        <operator id="updownBR" spec="UpDownOperator" scaleFactor="0.9" weight="3.0">
            <up idref="birthRate"/>
            <down idref="deathRate"/>
        </operator>

        <!-- Loggers -->
        <logger id="tracelog" spec="Logger" fileName="$(filebase).$(seed).log" logEvery="5000">
            <log idref="posterior"/>
<!--            <log idref="likelihood"/>-->
            <log idref="prior"/>
            <log id="treeHeight.t:alignment" spec="beast.evolution.tree.TreeHeightLogger" tree="@typewriterTree"/>
            <log id="treeLength.t:alignment" spec="multitypetree.util.TreeLengthLogger" tree="@typewriterTree"/>
            <log idref="insertRates"/>
            <log idref="birthRate"/>
            <log idref="samplingProportion"/>
            <log idref="deathRate"/>
            <log idref="clockRate"/>
        </logger>

        <logger id="screenlog" spec="Logger" logEvery="1000">
            <log idref="posterior"/>
            <log id="ESS.0" spec="util.ESS" arg="@posterior"/>
<!--            <log idref="likelihood"/>-->
            <log idref="prior"/>
        </logger>

        <logger id="treelog.t:alignment" spec="Logger" fileName="$(filebase).$(tree).$(seed).trees" logEvery="5000" mode="tree">
            <log idref="typewriterTree" printMetaData="true"/>
        </logger>


    </run>

</beast>